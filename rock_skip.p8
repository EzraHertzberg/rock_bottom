pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
current_frame = 0
birds = {}
function _init()
	for i = 1, 28 do
		add_bird( i * 128, 64)
	end
	rock_set()
end


function _update()
	current_frame = current_frame + 1
	rock_update()
	if btn(3) then
		rock_dive()
	end
	if btn(2)  and rock.y > 14*8 and rock.y < 16*8 then
		rock_skip()
	end
	if btn(4) and rock.sunk then
		rock_set()
	end
	if rock.y > 8 * 16 then
		rock_sink()
	end
	for i = 1, #birds do
		update_bird(birds[i])
			if collide(birds[i]) then
				rock.dy += 1		
			end
	end	
	

	
	
	
end

function _draw()
	cls(0)
	camera(0, 0)
	map(1, 1, 0, 0)
	print(current_frame % 30 == 0)
	camera(rock.x-40, 0)
	spr(rock.sprite, rock.x, rock.y, 1, 1)
	for i = 1, 100 do
		spr(5, 14 * i * 8, 4 + 14 * 8, 1, 1)
	end
	for i = 1, #birds do
		draw_bird(birds[i])
	end	
	print(#birds)
	
	if rock.sunk then
		camera(0, 0)
		lose()
	end
end
-->8
gravity = 0.1
rock = {

	}

function rock_set()
	rock.sprite = 1
	rock.x = 0
	rock.y = 0
	rock.w = 8
	rock.h = 4
	rock.dx = 1
	rock.dy = 0
	rock.sunk = false
	rock.dived = false
end

function rock_skip()
	rock.dx = 2
	rock.dy = 4
	rock.dived = false
end

function rock_dive()
	if not rock.dived then 
		rock.dy = rock.dy - 2
		rock.dived = true
	end
end


function rock_update()
	if not rock.sunk then
		rock.dy = rock.dy - gravity
		rock.x = rock.x + rock.dx
		rock.y = rock.y - rock.dy
	end
end

function rock_sink()
	rock.sunk = true
	rock.sprite = 6
	rock.y = 8 * 13
end

-->8
function lose()
	print("your rock sank, press z\nto restart")
end


function collide(obj)
	if rock.x + rock.w > obj.x and
	rock.x < obj.x + rock.w and
	rock.y + rock.h > obj.y and
	rock.y < obj.y + obj.h then
			return true
	end


end 
-->8
function add_bird(x, y)
	add(birds, {x = x,
	 y=y,
	 sprite = 7,
	 w = 7,
	 h = 4})
end

function draw_bird(bird)
	spr(bird.sprite, bird.x, bird.y) 
end

function update_bird(bird)
		if current_frame % 15 == 0 then
			if bird.sprite == 8 then
				bird.sprite = 7
			elseif bird.sprite == 7 then
				bird.sprite = 8
		end
	end
end
__gfx__
00000000006666000000000000000000000000000000000000100100000676000700000000000000000000000000000000000000000000000000000000000000
0000000006dddd600000000000000000000000000000000000000101070676009767777000000000000000000000000000000000000000000000000000000000
007007006dddddd60000000000000000000000000070000001100000976776700776760000000000000000000000000000000000000000000000000000000000
0007700006dddd600000000000000000000000000970000001101000077666000076760000000000000000000000000000000000000000000000000000000000
00077000006666000000000000000000000000000077000001101011007770000006660000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000076770011100010000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000077667001101010000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000077770001101010000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbcccccccc1111111100000000000000000000000001001010000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbcccccccc1111111100000000000000000000000011101011000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbcccccccc1111111100000000000000000000000001101111000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbcccccccc1111111100000000000000000000000011110111000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbcccccccc1111111100000000000000000000000011111111000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbcccccccc1111111100000000000000000000000011111111000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbcccccccc1111111100000000000000000000000011111111000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbcccccccc1111111100000000000000000000000011111111000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121212000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121212000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
